% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_terminal_ssb_f_bias_by_assessment.R
\name{plot_terminal_ssb_f_bias_by_assessment}
\alias{plot_terminal_ssb_f_bias_by_assessment}
\title{Plot terminal-year SSB and F bias by assessment}
\usage{
plot_terminal_ssb_f_bias_by_assessment(
  mods,
  is.nsim,
  main.dir,
  sub.dir,
  width = 10,
  height = 7,
  dpi = 300,
  col.opt = "D",
  plot.style = "median_iqr",
  outlier.opt = NA,
  show.whisker = TRUE,
  new_model_names = NULL
)
}
\arguments{
\item{mods}{A list of model outputs. For single-simulation runs
(\code{is.nsim = FALSE}) this is typically
\code{list(Mod1, Mod2, ...)} where each \code{ModX} has components
\code{$om} and \code{$em_list}. For multi-simulation runs
(\code{is.nsim = TRUE}) this is typically
\code{list(sim1 = list(Mod1, Mod2, ...), sim2 = list(...), ...)}.}

\item{is.nsim}{Logical; \code{FALSE} if \code{mods} is a simple list of
models, \code{TRUE} if \code{mods} is a list of simulations each
containing a list of models.}

\item{main.dir}{Main output directory.}

\item{sub.dir}{Subdirectory (relative to \code{main.dir}) where the
\code{"Diagnostics"} folder will be created and PNGs saved.}

\item{width, height}{Figure size passed to \code{ggsave()} (in inches).}

\item{dpi}{Resolution (dots per inch) for the saved PNG.}

\item{col.opt}{Viridis color option (passed to
\code{scale_color_viridis_d(option = ...)}).}

\item{plot.style}{Either \code{"boxplot"} or \code{"median_iqr"} to control
the style of the summary graphic.}

\item{outlier.opt}{Passed to \code{geom_boxplot(outlier.shape = ...)} when
\code{plot.style = "boxplot"}. Use \code{NA} to hide outliers.}

\item{show.whisker}{Logical; if \code{TRUE} and
\code{plot.style = "median_iqr"}, draw whiskers at 1.5Ã—IQR (clipped to
observed min/max).}

\item{new_model_names}{Optional character vector of new model names to use
on the x-axis and in the legend. Length must match the number of models.}
}
\value{
A named list of \code{ggplot} objects (one per assessment) is
  returned (invisibly). PNG files are written to
  \code{file.path(main.dir, sub.dir, "Diagnostics")}.
}
\description{
For each assessment in the feedback loop (each element of \code{em_list}),
compute the terminal-year global SSB and F bias for every estimation model
and realization, relative to the corresponding operating model (OM) values
for that year. SSB is row-summed across regions for both OM and EM; F uses
the global F column (last column of \code{Fbar}) in both OM and EM.
}
\details{
For assessment \eqn{k}, the function:
\itemize{
  \item Takes the EM's terminal-year global SSB (sum over regions) and aligns
        it with the OM global SSB in the same year.
  \item Takes the EM's terminal-year global F (last column of \code{Fbar})
        and aligns it with the OM global F in the same year.
  \item Computes relative bias:
        \deqn{\text{Bias} = \frac{\text{EM}}{\text{OM}} - 1}
        separately for SSB and F.
  \item Collects these across estimation models and realizations and
        produces a boxplot- or median-IQR-style summary, faceted by
        \code{"SSB"} and \code{"F"}.
}

One PNG file is saved per assessment in:
\code{file.path(main.dir, sub.dir, "Diagnostics")}, with names like
\code{"Terminal_bias_assessment_01.png"}.


The function assumes:
\itemize{
  \item OM SSB is in \code{om$rep$SSB}, with columns = regions.
  \item OM F is in \code{om$rep$Fbar}, with columns = fleets, regions,
        and a final global column; the last column is taken as global F.
  \item Each EM object in \code{em_list[[k]]} has:
        \code{SSB} (or \code{rep$SSB}) and \code{Fbar} (or
        \code{rep$Fbar}) with the same structure as the OM.
  \item The EM terminal-year index (number of rows in EM SSB) is interpreted
        as the year index in the OM; the function aligns OM and EM by this
        index for each assessment.
}
}
\examples{
\dontrun{
# Suppose `mods` is a multi-simulation object from whamMSE with feedback EMs:
plot_terminal_ssb_f_bias_by_assessment(
  mods           = mods,
  is.nsim        = TRUE,
  main.dir       = "Results",
  sub.dir        = "Report",
  width          = 10,
  height         = 7,
  dpi            = 300,
  col.opt        = "D",
  plot.style     = "median_iqr",
  outlier.opt    = NA,
  show.whisker   = TRUE,
  new_model_names = c("Equal", "FleetCatch", "IndexEqual")
)
}

}
