% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_NAA_tile_by_realization.R
\name{plot_NAA_tile_by_realization}
\alias{plot_NAA_tile_by_realization}
\title{Tile plots of NAA deviations by realization (OM or EM)}
\usage{
plot_NAA_tile_by_realization(
  mods,
  type = "OM",
  em_index = NULL,
  main.dir,
  sub.dir,
  pdf_name = "NAA_tile_by_realization.pdf",
  width = NULL,
  height = NULL,
  fontfam = "",
  realizations_to_plot = NULL,
  new_model_names = NULL
)
}
\arguments{
\item{mods}{A list of MSE results. For OM plots, this must be a list of
realizations, each containing at least one model with an \code{$om}
component (with \code{$env$data}, \code{$rep}, \code{$years}, etc.).
For EM plots, each realization must be a list of models, each having
\code{$em_list} (a list of assessment fits with \code{NAA_devs}) and
\code{$em_input} (input lists with \code{years_full}).}

\item{type}{Character string indicating which component to plot:
\code{"OM"} for operating model \code{NAA_devs}, or \code{"EM"} for
estimation model \code{NAA_devs}.}

\item{em_index}{Optional integer index of the estimation model to focus on.
Currently not used; reserved for potential future extensions.}

\item{main.dir}{Character path to the main output directory.}

\item{sub.dir}{Character folder name inside \code{main.dir} where the PDF
will be written. The directory is created if it does not exist.}

\item{pdf_name}{Name of the output PDF file (default:
\code{"NAA_tile_by_realization.pdf"}).}

\item{width, height}{Numeric width and height (in inches) for the PDF device.
If both are \code{NULL}, defaults depend on \code{type}:
\itemize{
  \item \code{type == "OM"}: \code{width = 15}, \code{height = 5}
  \item \code{type == "EM"}: \code{width = 10}, \code{height = 10}
}}

\item{fontfam}{Optional font family name passed to the PDF device. Currently
not explicitly used in the plotting theme but can be set via global theme
modifications if desired.}

\item{realizations_to_plot}{Optional integer vector of realization indices
to include. If \code{NULL}, all realizations (\code{seq_len(length(mods))})
are plotted.}

\item{new_model_names}{Optional character vector of new model names for EM
plots. If provided, must have length equal to the number of models in each
realization, and will be used to relabel the \code{Model} factor.}
}
\value{
Invisibly returns \code{NULL}. The primary side effect is the creation of a
multi-page PDF of NAA deviation tiles in \code{file.path(main.dir, sub.dir, pdf_name)}.
}
\description{
Create heatmap (tile) plots of numbers-at-age deviations (`NAA_devs`) across
years and ages, for each realization in an MSE run. The function can plot
either the operating model (OM) deviations or the estimation model (EM)
deviations, optionally looping over all assessments and models.
}
\details{
For `type = "OM"`, the function:
\itemize{
  \item assumes \code{mods} is a list of realizations, each containing at least
        one model with an \code{$om} component,
  \item extracts \code{NAA_devs} from the OM report object
        (\code{mod$rep$NAA_devs}) for each stock and region, and
  \item plots deviations as tiles over \code{Year} (x-axis) and \code{Age} (y-axis),
        faceted by \code{Stock} and \code{Region} with one row per realization.
}

For `type = "EM"`, the function:
\itemize{
  \item assumes \code{mods} is a list of realizations, each being a list of models
        with elements \code{$em_list} (assessment fits) and \code{$em_input},
  \item loops over assessments within each realization and across all models,
  \item extracts \code{NAA_devs} for each stock and region from the EM report object,
        and
  \item plots deviations as tiles over \code{Year} and \code{Age}, faceted by
        a combined label of model, stock, and region.
}

All plots are written to a single multi-page PDF in
\code{file.path(main.dir, sub.dir, pdf_name)}.


The function checks for a "multi-simulation" structure in \code{mods} by
testing if \code{mods[[1]]} is a list and if \code{mods[[1]][[1]]$om} is
non-\code{NULL}. If this is not the case, the function stops with an error,
as it expects \code{mods} to be a list of realizations.

For OM plots (`type = "OM"`), the code uses:
\itemize{
  \item \code{mod$env$data} to obtain dimensions (\code{n_ages}, \code{n_stocks},
        \code{n_regions}, \code{n_years_proj}),
  \item \code{mod$rep$NAA_devs[s, rn, , ]} as the age-by-year deviations for
        stock \code{s} and region \code{rn}, and
  \item \code{mod$years_full} when projection years exist, otherwise
        \code{mod$years}.
}

For EM plots (`type = "EM"`), the function loops over assessments within
each model and realization:
\itemize{
  \item \code{em_list[[x]]$NAA_devs[s, rn, , ]} is used as the age-by-year
        deviations for assessment \code{x},
  \item \code{em_input_list[[x]]$years_full} provides the full year vector,
  \item a combined facet label \code{"ModelX_stock_s_region_r"} is built for
        each model/stock/region combination.
}

The color scale for deviations uses \code{viridis::scale_fill_viridis()}.
}
\examples{
\dontrun{
# Suppose `mods` is a list of realizations produced by whamMSE:
# Plot OM NAA devs for all realizations:
plot_NAA_tile_by_realization(
  mods      = mods,
  type      = "OM",
  main.dir  = "Results",
  sub.dir   = "Diagnostics"
)

# Plot EM NAA devs for realizations 1 and 2 only, relabeling models:
plot_NAA_tile_by_realization(
  mods                 = mods,
  type                 = "EM",
  main.dir             = "Results",
  sub.dir              = "Diagnostics",
  realizations_to_plot = c(1, 2),
  new_model_names      = c("Equal", "FleetCatch", "IndexEqual")
)
}
}
\seealso{
Other diagnostic plots in the package (e.g. terminal SSB/F bias plots) for
assessing estimation performance across realizations and assessments.
}
